name: Simple CI

on: [push, pull_request]

jobs:
  build-ubuntu:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1 
    - name: install-dependencies
      run: sudo apt-get install build-essential ninja-build cmake git libboost-dev libboost-date-time-dev libboost-system-dev libboost-filesystem-dev libboost-thread-dev libboost-chrono-dev libboost-serialization-dev liblog4cpp5-dev gnuradio-dev gr-osmosdr libpugixml-dev libpcap-dev libblas-dev liblapack-dev libarmadillo-dev libgflags-dev libgoogle-glog-dev libgnutls-openssl-dev python-mako python-six libmatio-dev googletest protobuf-compiler libprotobuf-dev 
    - name: configure
      run: cd build && cmake -GNinja ..
    - name: build
      run: cd build && ninja
    - name: check
      run: cd build && ninja check && ../install/volk_gnsssdr_profile && ../install/run_tests


  build-macos:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v1
    - name: install-dependencies
      run: sudo easy_install pip && brew install ninja pkg-config hdf5 armadillo lapack gflags glog gnuradio libmatio log4cpp pugixml protobuf && pip install mako && pip install six
    - name: configure
      run: cd build && cmake -GNinja ..
    - name: build
      run: cd build && ninja
    - name: check
      run: cd build && ninja check && ../install/volk_gnsssdr_profile && ../install/run_tests 


  volk-gnsssdr-windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v1
    - uses: actions/setup-python@v1
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install .
        pip install mako six
    - name: configure-volk
      shell: powershell
      run: cd build; cmake -G "Visual Studio 16 2019" ../src/algorithms/libs/volk_gnsssdr_module/volk_gnsssdr
    - name: run-volk   
      run: cmake --build build --config Release
    - name: test
      shell: powershell
      run: cd build; ctest
